{"ast":null,"code":"import _regeneratorRuntime from\"/home/petersonguo/Documents/Projects/AssistedReader/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/petersonguo/Documents/Projects/AssistedReader/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/petersonguo/Documents/Projects/AssistedReader/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useRef,useState}from'react';import'./Cam.css';import Webcam from\"react-webcam\";import Tesseract from\"tesseract.js\";import{GoMute,GoUnmute}from\"react-icons/go\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var videoConstraints={width:440,height:400,facingMode:\"user\"};export default function Cam(){var webcamRef=useRef(null);var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),speak=_useState4[0],setSpeak=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),readData=_useState6[0],setReadData=_useState6[1];function talk(_x){return _talk.apply(this,arguments);}function _talk(){_talk=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(text){var speech;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:speech=new SpeechSynthesisUtterance();speech.txt=text;window.speechSynthesis.speak(speech);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return _talk.apply(this,arguments);}useEffect(function(){var pause=setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!readData){_context2.next=4;break;}console.log('run');_context2.next=4;return Tesseract.recognize(webcamRef.current.getScreenshot(),'eng').catch(function(x){console.error(x);}).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(result){var txt;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:txt=result.data.text;console.log(txt+\": \"+result.data.confidence);if(!(result.data.confidence>50)){_context.next=10;break;}_context.next=5;return fetch(\"/autocorrect\",{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text:txt})}).then(function(res){return res.json();}).then(function(response){txt=response.text;setText(response.text);});case 5:console.log('autocorrected: '+text);if(!speak){_context.next=10;break;}console.log('speech: '+text);_context.next=10;return talk(text);case 10:case\"end\":return _context.stop();}}},_callee);}));return function(_x2){return _ref2.apply(this,arguments);};}());case 4:case\"end\":return _context2.stop();}}},_callee2);})),500);return function(){return clearInterval(pause);};},[text,readData,speak]);return/*#__PURE__*/_jsx(\"div\",{className:\"my-[40px] justify-center items-center flex\",children:/*#__PURE__*/_jsxs(\"main\",{className:\"items-center\",children:[/*#__PURE__*/_jsx(Webcam,{audio:false,ref:webcamRef,screenshotFormat:\"image/jpeg\",videoConstraints:videoConstraints,className:\"h-50 border-2 border-black rounded-3xl\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-lg my-3\",children:\"Extracted Text\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-box extractedText text-center\",children:[\" \",text,\" \"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex row\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){setReadData(!readData);},className:\"h-[50] m-5\",children:!readData?'Start Reading':'Stop Reading'}),speak?/*#__PURE__*/_jsx(GoUnmute,{className:\"text-white hover:cursor-pointer\",size:30,onClick:function onClick(){return setSpeak(!speak);}}):/*#__PURE__*/_jsx(GoMute,{className:\"text-white hover:cursor-pointer\",size:30,onClick:function onClick(){return setSpeak(!speak);}})]})]})});}","map":{"version":3,"names":["React","useEffect","useRef","useState","Webcam","Tesseract","GoMute","GoUnmute","videoConstraints","width","height","facingMode","Cam","webcamRef","text","setText","speak","setSpeak","readData","setReadData","talk","speech","SpeechSynthesisUtterance","txt","window","speechSynthesis","pause","setInterval","console","log","recognize","current","getScreenshot","catch","x","error","then","result","data","confidence","fetch","method","headers","body","JSON","stringify","res","json","response","clearInterval"],"sources":["/home/petersonguo/Documents/Projects/AssistedReader/src/components/Cam.jsx"],"sourcesContent":["import React, {useEffect, useRef, useState} from 'react';\nimport './Cam.css';\nimport Webcam from \"react-webcam\";\nimport Tesseract from \"tesseract.js\";\nimport {GoMute, GoUnmute} from \"react-icons/go\";\n\nconst videoConstraints = {\n    width: 440,\n    height: 400,\n    facingMode: \"user\"\n};\n\nexport default function Cam() {\n    const webcamRef = useRef(null);\n    const [text, setText] = useState(\"\");\n    const [speak, setSpeak] = useState(false);\n    const [readData, setReadData] = useState(false);\n\n    async function talk(text) {\n        const speech = new SpeechSynthesisUtterance();\n        speech.txt = text;\n        window.speechSynthesis.speak(speech);\n    }\n\n    useEffect(() => {\n        const pause = setInterval(async () => {\n            if (readData) {\n                console.log('run')\n                await Tesseract.recognize(\n                    webcamRef.current.getScreenshot(), 'eng'\n                )\n                    .catch(x => {\n                        console.error(x);\n                    })\n                    .then(async result => {\n                        let txt = result.data.text;\n                        console.log(txt + \": \" + result.data.confidence);\n                        if (result.data.confidence > 50) {\n                            await fetch(\"/autocorrect\", {\n                                method: 'POST',\n                                headers: {\n                                    'Content-Type': 'application/json'\n                                },\n                                body: JSON.stringify({\n                                    text: txt\n                                })\n                            })\n                                .then(res => res.json())\n                                .then(response => {\n                                    txt = response.text;\n                                    setText(response.text);\n                                });\n                            console.log('autocorrected: ' + text);\n                            if (speak) {\n                                console.log('speech: ' + text);\n                                await talk(text);\n                            }\n                        }\n                    });\n            }\n        }, 500);\n        return () => clearInterval(pause);\n    }, [text, readData, speak]);\n\n    return (\n        <div className={\"my-[40px] justify-center items-center flex\"}>\n\n            <main className=\"items-center\">\n                <Webcam\n                    audio={false}\n                    ref={webcamRef}\n                    screenshotFormat=\"image/jpeg\"\n                    videoConstraints={videoConstraints}\n                    className={\"h-50 border-2 border-black rounded-3xl\"}\n                />\n                <h1 className={\"text-lg my-3\"}>Extracted Text</h1>\n                <p className=\"text-box extractedText text-center\"> {text} </p>\n                <div className={\"flex row\"}>\n                    <button onClick={() => {\n                        setReadData(!readData)\n                    }} className={\"h-[50] m-5\"}>\n                        {!readData ? 'Start Reading' : 'Stop Reading'}\n                    </button>\n                    {\n                        speak ?\n                            <GoUnmute className={\"text-white hover:cursor-pointer\"}\n                                      size={30}\n                                      onClick={() => setSpeak(!speak)}/> :\n                            <GoMute className={\"text-white hover:cursor-pointer\"} size={30}\n                                    onClick={() => setSpeak(!speak)}/>\n                    }\n                </div>\n            </main>\n        </div>\n    );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}